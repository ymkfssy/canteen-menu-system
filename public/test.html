<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API测试页面</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { padding: 10px 15px; margin: 5px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>食堂菜单系统API测试</h1>
    
    <div class="test-section">
        <h2>1. 测试菜单API</h2>
        <button onclick="testGetMenu()">测试获取菜单</button>
        <div id="menuResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. 测试主题API</h2>
        <button onclick="testGetThemes()">测试获取主题</button>
        <div id="themeResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. 测试保存菜单</h2>
        <button onclick="testSaveMenu()">测试保存菜单</button>
        <div id="saveResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. 测试认证</h2>
        <button onclick="testAuth()">测试登录</button>
        <div id="authResult"></div>
    </div>

    <script>
        const API_BASE = '/api';
        
        async function testGetMenu() {
            const result = document.getElementById('menuResult');
            result.innerHTML = '测试中...';
            
            try {
                const response = await fetch(`${API_BASE}/menu`);
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">✓ 成功获取菜单数据</span><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<span class="error">✗ 获取失败: ${data.error || response.status}</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">✗ 请求失败: ${error.message}</span>`;
            }
        }
        
        async function testGetThemes() {
            const result = document.getElementById('themeResult');
            result.innerHTML = '测试中...';
            
            try {
                const response = await fetch(`${API_BASE}/theme`);
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">✓ 成功获取主题数据</span><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<span class="error">✗ 获取失败: ${data.error || response.status}</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">✗ 请求失败: ${error.message}</span>`;
            }
        }
        
        async function testSaveMenu() {
            const result = document.getElementById('saveResult');
            result.innerHTML = '测试中...';
            
            const testData = {
                coldDishes: [{ name: "测试凉菜", price: 10.00 }],
                hotDishes: [{ name: "测试热菜", price: 20.00 }],
                staples: [{ name: "测试主食", price: 5.00 }],
                soups: [{ name: "测试汤品", price: 8.00 }],
                fruits: [{ name: "测试水果", price: 6.00 }]
            };
            
            try {
                const response = await fetch(`${API_BASE}/menu`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">✓ 保存成功</span><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<span class="error">✗ 保存失败: ${data.error || response.status}</span><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">✗ 请求失败: ${error.message}</span>`;
            }
        }
        
        async function testAuth() {
            const result = document.getElementById('authResult');
            result.innerHTML = '测试中...';
            
            try {
                const response = await fetch(`${API_BASE}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin' })
                });
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = `<span class="success">✓ 认证成功</span><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    result.innerHTML = `<span class="error">✗ 认证失败: ${data.error || response.status}</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">✗ 请求失败: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
